-- MySQL Script generated by MySQL Workbench
-- 09/24/15 20:25:15
-- Model: bike    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema storebike
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `storebike` ;

-- -----------------------------------------------------
-- Schema storebike
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `storebike` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ;
USE `storebike` ;

-- -----------------------------------------------------
-- Table `storebike`.`ensambladores`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`ensambladores` ;

CREATE TABLE IF NOT EXISTS `storebike`.`ensambladores` (
  `cod_emp` VARCHAR(6) NOT NULL,
  `id_emp` VARCHAR(15) NOT NULL,
  `nom_emp` VARCHAR(25) NOT NULL,
  `ape_emp` VARCHAR(25) NULL,
  `tel_emp` VARCHAR(18) NULL,
  `dir_emp` VARCHAR(30) NULL,
  `fecha_ing` DATE NULL,
  `fecha_salida` DATE NULL,
  PRIMARY KEY (`cod_emp`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`ordenes_produccion`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`ordenes_produccion` ;

CREATE TABLE IF NOT EXISTS `storebike`.`ordenes_produccion` (
  `no_ord` INT NOT NULL AUTO_INCREMENT,
  `cod_emp` VARCHAR(6) NOT NULL,
  `despachado` DATETIME(0) NOT NULL,
  `entregado` DATETIME(0) NULL,
  `ord_activa` TINYINT(1) NOT NULL,
  PRIMARY KEY (`no_ord`),
  INDEX `fk_ordenes_produccion_empleados_idx` (`cod_emp` ASC),
  CONSTRAINT `fk_ordenes_produccion_empleados`
    FOREIGN KEY (`cod_emp`)
    REFERENCES `storebike`.`ensambladores` (`cod_emp`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`componentes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`componentes` ;

CREATE TABLE IF NOT EXISTS `storebike`.`componentes` (
  `id_comp` VARCHAR(3) NOT NULL,
  `componente` VARCHAR(25) NOT NULL,
  PRIMARY KEY (`id_comp`),
  UNIQUE INDEX `cod_fam_UNIQUE` (`id_comp` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`marcas`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`marcas` ;

CREATE TABLE IF NOT EXISTS `storebike`.`marcas` (
  `id_marca` CHAR(2) NOT NULL,
  `nombre_marca` VARCHAR(10) NOT NULL,
  `proveedor` VARCHAR(5) NULL,
  PRIMARY KEY (`id_marca`),
  UNIQUE INDEX `id_marca_UNIQUE` (`id_marca` ASC))
ENGINE = MyISAM;


-- -----------------------------------------------------
-- Table `storebike`.`repuestos`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`repuestos` ;

CREATE TABLE IF NOT EXISTS `storebike`.`repuestos` (
  `plu` VARCHAR(6) NOT NULL,
  `descripcion` VARCHAR(45) NOT NULL,
  `componente` VARCHAR(4) NOT NULL,
  `cant_disp` INT NULL,
  `marca` CHAR(2) NULL,
  PRIMARY KEY (`plu`),
  UNIQUE INDEX `plu_UNIQUE` (`plu` ASC),
  INDEX `fk_componentes_familia1_idx` (`componente` ASC),
  INDEX `fk_repuestos_marcas1_idx` (`marca` ASC),
  CONSTRAINT `fk_tipo_componente`
    FOREIGN KEY (`componente`)
    REFERENCES `storebike`.`componentes` (`id_comp`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_repuestos_marcas`
    FOREIGN KEY (`marca`)
    REFERENCES `storebike`.`marcas` (`id_marca`)
    ON DELETE SET NULL
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`despacho`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`despacho` ;

CREATE TABLE IF NOT EXISTS `storebike`.`despacho` (
  `orden` INT NOT NULL,
  `repuesto` VARCHAR(6) NOT NULL,
  `cant_out` INT NOT NULL,
  INDEX `fk_ordenes_produccion_has_articulos_ordenes_produccion1_idx` (`orden` ASC),
  INDEX `fk_detalle_orden_componentes1_idx` (`repuesto` ASC),
  PRIMARY KEY (`orden`, `repuesto`),
  CONSTRAINT `fk_ordenes_produccion_has_articulos_ordenes_produccion1`
    FOREIGN KEY (`orden`)
    REFERENCES `storebike`.`ordenes_produccion` (`no_ord`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_detalle_orden_componentes1`
    FOREIGN KEY (`repuesto`)
    REFERENCES `storebike`.`repuestos` (`plu`)
    ON DELETE NO ACTION
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`articulos`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`articulos` ;

CREATE TABLE IF NOT EXISTS `storebike`.`articulos` (
  `id_articulo` VARCHAR(3) NOT NULL,
  `articulo` VARCHAR(25) NOT NULL,
  `descripcion` VARCHAR(200) NULL,
  `imagen` LONGBLOB NULL,
  PRIMARY KEY (`id_articulo`),
  UNIQUE INDEX `id_cat_UNIQUE` (`id_articulo` ASC),
  UNIQUE INDEX `categoria_UNIQUE` (`articulo` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`productos`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`productos` ;

CREATE TABLE IF NOT EXISTS `storebike`.`productos` (
  `no_ord_produccion` INT NOT NULL,
  `articulo` VARCHAR(3) NOT NULL,
  `cantidad` INT NOT NULL,
  INDEX `fk_ordenes_produccion_has_stock_producido_ordenes_produccio_idx` (`no_ord_produccion` ASC),
  INDEX `fk_artefacto_producido_tipo_articulo1_idx` (`articulo` ASC),
  PRIMARY KEY (`no_ord_produccion`, `articulo`),
  CONSTRAINT `fk_ordenes_produccion_has_stock_producido_ordenes_produccion1`
    FOREIGN KEY (`no_ord_produccion`)
    REFERENCES `storebike`.`ordenes_produccion` (`no_ord`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_artefacto_producido_tipo_articulo1`
    FOREIGN KEY (`articulo`)
    REFERENCES `storebike`.`articulos` (`id_articulo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `storebike`.`repuesto_articulo`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `storebike`.`repuesto_articulo` ;

CREATE TABLE IF NOT EXISTS `storebike`.`repuesto_articulo` (
  `articulo` VARCHAR(3) NOT NULL,
  `plu_repuesto` VARCHAR(6) NOT NULL,
  PRIMARY KEY (`articulo`, `plu_repuesto`),
  INDEX `fk_componentes_has_artefactos_artefactos1_idx` (`articulo` ASC),
  INDEX `fk_componente_artefacto_repuestos1_idx` (`plu_repuesto` ASC),
  CONSTRAINT `fk_artefacto_compatible`
    FOREIGN KEY (`articulo`)
    REFERENCES `storebike`.`articulos` (`id_articulo`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_repuesto_compatible`
    FOREIGN KEY (`plu_repuesto`)
    REFERENCES `storebike`.`repuestos` (`plu`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
